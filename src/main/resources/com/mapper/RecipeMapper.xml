<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mapper.RecipeMapper">
    <insert id="insertRecipe" parameterType="com.pojo.MedicinalDiet">
        INSERT INTO recipe (
        type, name, intro, taboo, effect, suitable_time,
        method, ingredients, tags, create_time, is_valid
        ) VALUES (
        #{type}, #{name}, #{intro}, #{taboo}, #{effect}, #{suitableTime},
        #{method}, #{ingredients},
        <choose>
            <!-- 正确写法：去掉#{tag}外层的单引号 -->
            <when test="tags != null and not tags.isEmpty()">
                JSON_ARRAY(
                <foreach collection="tags" item="tag" separator=",">
                    #{tag}  <!-- 这里不要加单引号 -->
                </foreach>
                )
            </when>
            <otherwise>
                NULL  <!-- 或 JSON_ARRAY() 空数组 -->
            </otherwise>
        </choose>,
        #{createTime}, #{isValid}
        )
    </insert>
</mapper>